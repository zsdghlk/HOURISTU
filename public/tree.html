<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Repo Tree Viewer</title>
<style>
  :root { --fg:#111; --muted:#666; --bg:#fff; --line:#ddd; --accent:#0b5fff; }
  @media (prefers-color-scheme: dark) {
    :root { --fg:#eee; --muted:#aaa; --bg:#0b0f17; --line:#2a2f3a; --accent:#6aa3ff; }
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font:14px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif}
  header{position:sticky;top:0;background:var(--bg);border-bottom:1px solid var(--line);padding:10px 12px;z-index:5}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input[type="search"]{flex:1;min-width:220px;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--fg)}
  .btn{border:1px solid var(--line);padding:8px 10px;border-radius:10px;background:transparent;color:var(--fg);cursor:pointer}
  .btn:hover{border-color:var(--accent)}
  main{padding:12px;display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media (max-width: 980px){ main{grid-template-columns:1fr} #panel{order:-1} }
  .stats{color:var(--muted);font-size:12px}
  .tree{margin:10px 0 40px 0}
  .tree ul{list-style:none;padding-left:20px;border-left:1px dashed var(--line)}
  .tree li{margin:2px 0;white-space:nowrap;cursor:default}
  .node{display:flex;align-items:center;gap:6px}
  .label{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
  .dir>.label{font-weight:600}
  .file .ext{color:var(--muted);font-size:12px}
  details{margin:2px 0}
  details>summary{list-style:none;cursor:pointer}
  summary::-webkit-details-marker{display:none}
  .hit{background:rgba(11,95,255,0.10);border-radius:6px}
  .muted{color:var(--muted)}
  #panel{border:1px solid var(--line);border-radius:12px;padding:12px}
  #panel h3{margin:0 0 8px 0;font-size:16px}
  #panel .kv{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px}
  #panel .role{display:inline-block;padding:2px 8px;border:1px solid var(--line);border-radius:20px;margin:4px 0}
  #panel .desc{margin:8px 0;color:var(--muted)}
  .clickable{cursor:pointer}
  .selected{outline:2px solid var(--accent);border-radius:6px}
</style>
</head>
<body>
<header>
  <div class="row">
    <input id="q" type="search" placeholder="ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆä¾‹: app/law, *.tsx, apiï¼‰" />
    <button id="expand" class="btn">ã™ã¹ã¦å±•é–‹</button>
    <button id="collapse" class="btn">ã™ã¹ã¦æŠ˜ã‚ŠãŸãŸã¿</button>
    <span id="stats" class="stats"></span>
  </div>
</header>
<main>
  <section>
    <div id="rootName" class="muted"></div>
    <div id="tree" class="tree"></div>
  </section>
  <aside id="panel">
    <h3>ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±</h3>
    <div id="p_name" class="kv">é¸æŠã—ã¦ãã ã•ã„</div>
    <div id="p_role" class="role"></div>
    <div id="p_desc" class="desc"></div>
    <div class="kv"><b>Path:</b> <span id="p_path"></span></div>
    <div class="kv"><b>Type:</b> <span id="p_type"></span></div>
    <div class="kv"><b>Ext:</b> <span id="p_ext"></span></div>
  </aside>
</main>
<script>
  const DATA = {"name": "HOURISTU", "type": "dir", "children": [{"name": "api", "type": "dir", "children": [{"name": "law", "type": "dir", "children": [{"name": "[lawId]", "type": "dir", "children": [{"name": "article", "type": "dir", "children": []}, {"name": "loading.tsx", "type": "file"}, {"name": "page.tsx", "type": "file"}, {"name": "route.ts", "type": "file"}]}]}, {"name": "updates", "type": "dir", "children": [{"name": "route.ts", "type": "file"}]}]}, {"name": "app", "type": "dir", "children": [{"name": "api", "type": "dir", "children": [{"name": "debug", "type": "dir", "children": [{"name": "law", "type": "dir", "children": []}]}, {"name": "easy", "type": "dir", "children": [{"name": "import", "type": "dir", "children": []}]}, {"name": "law", "type": "dir", "children": [{"name": "[lawId]", "type": "dir", "children": []}, {"name": "route.ts.bak.1758259677", "type": "file"}, {"name": "route.ts.bak.1758261229", "type": "file"}, {"name": "route.ts.bak.1758261289", "type": "file"}]}]}, {"name": "contact", "type": "dir", "children": [{"name": "page.tsx", "type": "file"}]}, {"name": "easy", "type": "dir", "children": [{"name": "paste", "type": "dir", "children": [{"name": "page.tsx", "type": "file"}]}, {"name": "view", "type": "dir", "children": [{"name": "[lawId]", "type": "dir", "children": []}]}]}, {"name": "favicon.ico", "type": "dir", "children": [{"name": "route.ts", "type": "file"}]}, {"name": "law", "type": "dir", "children": [{"name": "[lawId]", "type": "dir", "children": [{"name": "loading.tsx", "type": "file"}, {"name": "page.backup.1757751382.tsx", "type": "file"}, {"name": "page.tsx", "type": "file"}, {"name": "page.tsx.bak", "type": "file"}, {"name": "page.tsx.bak.1757742410", "type": "file"}, {"name": "page.tsx.bak.1757742532", "type": "file"}, {"name": "page.tsx.bak.1757745036", "type": "file"}, {"name": "page.tsx.bak.1757745141", "type": "file"}, {"name": "page.tsx.bak.1757764821", "type": "file"}, {"name": "page.tsx.bak.1757767463", "type": "file"}, {"name": "page.tsx.bak.1757768786", "type": "file"}, {"name": "page.tsx.bak.1757769256", "type": "file"}, {"name": "page.tsx.bak.1757772031", "type": "file"}, {"name": "page.tsx.bak.1757772388", "type": "file"}, {"name": "page.tsx.bak.1757772433", "type": "file"}, {"name": "page.tsx.bak.1757772444", "type": "file"}, {"name": "page.tsx.bak.1757772705", "type": "file"}, {"name": "page.tsx.bak.1757912258", "type": "file"}, {"name": "page.tsx.bak.1757913992", "type": "file"}, {"name": "page.tsx.bak.1757914559", "type": "file"}, {"name": "page.tsx.bak.1757915222", "type": "file"}, {"name": "page.tsx.bak.1757915721", "type": "file"}, {"name": "page.tsx.bak.1757925580", "type": "file"}, {"name": "page.tsx.bak.1757926428", "type": "file"}, {"name": "page.tsx.bak.1757937307", "type": "file"}, {"name": "page.tsx.bak.1757980949", "type": "file"}, {"name": "page.tsx.bak.1757981167", "type": "file"}, {"name": "page.tsx.bak.1757981288", "type": "file"}, {"name": "page.tsx.bak.1757981364", "type": "file"}, {"name": "page.tsx.bak.1757981403", "type": "file"}, {"name": "page.tsx.bak.1757981435", "type": "file"}, {"name": "page.tsx.bak.1757981493", "type": "file"}, {"name": "page.tsx.bak.1757981643", "type": "file"}, {"name": "page.tsx.bak.1757981741", "type": "file"}, {"name": "page.tsx.bak.1757981893", "type": "file"}, {"name": "page.tsx.bak.1757981998", "type": "file"}, {"name": "page.tsx.bak.1757985142", "type": "file"}, {"name": "page.tsx.bak.1757986400", "type": "file"}, {"name": "page.tsx.bak.1757987351", "type": "file"}, {"name": "page.tsx.bak.1757987554", "type": "file"}, {"name": "page.tsx.bak.1757987878", "type": "file"}, {"name": "page.tsx.bak.1758259132", "type": "file"}, {"name": "page.tsx.bak.1758414703", "type": "file"}, {"name": "page.tsx.bak.1758415489", "type": "file"}, {"name": "page.tsx.bak.1758415594", "type": "file"}, {"name": "page.tsx.bak.1758416208", "type": "file"}, {"name": "page.tsx.bak.1758416337", "type": "file"}, {"name": "page.tsx.keep.1757913754", "type": "file"}]}, {"name": "test", "type": "dir", "children": [{"name": "page.tsx", "type": "file"}]}, {"name": "layout.tsx", "type": "file"}, {"name": "layout.tsx.bak.1758416850", "type": "file"}, {"name": "layout.tsx.bak.1758416938", "type": "file"}, {"name": "layout.tsx.bak.1758417057", "type": "file"}, {"name": "layout.tsx.bak.1758417241", "type": "file"}, {"name": "layout.tsx.bak.1758417373", "type": "file"}, {"name": "layout.tsx.bak.1758417647", "type": "file"}, {"name": "layout.tsx.bak.1758417725", "type": "file"}, {"name": "layout.tsx.bak.1758417810", "type": "file"}, {"name": "layout.tsx.bak.1758417816", "type": "file"}, {"name": "layout.tsx.bak.1758417911", "type": "file"}, {"name": "layout.tsx.bak.1758419098", "type": "file"}, {"name": "layout.tsx.bak.1758419784", "type": "file"}, {"name": "layout.tsx.bak.1758419969", "type": "file"}, {"name": "layout.tsx.bak.1758420152", "type": "file"}, {"name": "layout.tsx.bak.1758420487", "type": "file"}, {"name": "layout.tsx.bak.1758420648", "type": "file"}, {"name": "layout.tsx.bak.1758421510", "type": "file"}, {"name": "layout.tsx.bak.1758421864", "type": "file"}]}, {"name": "laws", "type": "dir", "children": [{"name": "[lawId]", "type": "dir", "children": [{"name": "page.tsx", "type": "file"}]}]}, {"name": "apple-icon.svg", "type": "file"}, {"name": "globals.css", "type": "file"}, {"name": "globals.css.bak.1757926875", "type": "file"}, {"name": "globals.css.bak.1757927137", "type": "file"}, {"name": "globals.css.bak.1757927505", "type": "file"}, {"name": "globals.css.bak.1758419484", "type": "file"}, {"name": "globals.css.bak.1758419974", "type": "file"}, {"name": "globals.css.bak.1758420487", "type": "file"}, {"name": "globals.css.bak.1758421012", "type": "file"}, {"name": "globals.css.bak.1758421172", "type": "file"}, {"name": "globals.css.bak.1758421515", "type": "file"}, {"name": "globals.css.bak.1758421868", "type": "file"}, {"name": "globals.css.bak.1758422433", "type": "file"}, {"name": "globals.css.bak.1758422810", "type": "file"}, {"name": "icon.svg", "type": "file"}, {"name": "layout.tsx", "type": "file"}, {"name": "layout.tsx.bak.1758419088", "type": "file"}, {"name": "layout.tsx.bak.1758419477", "type": "file"}, {"name": "layout.tsx.bak.1758420284", "type": "file"}, {"name": "layout.tsx.bak.1758420487", "type": "file"}, {"name": "layout.tsx.bak.1758420738", "type": "file"}, {"name": "layout.tsx.bak.1758420830", "type": "file"}, {"name": "layout.tsx.bak.1758421166", "type": "file"}, {"name": "layout.tsx.bak.1758421349", "type": "file"}, {"name": "layout.tsx.bak.1758421503", "type": "file"}, {"name": "layout.tsx.bak.1758421859", "type": "file"}, {"name": "layout.tsx.bak.1758422433", "type": "file"}, {"name": "layout.tsx.bak.1758422810", "type": "file"}, {"name": "page.tsx", "type": "file"}]}, {"name": "backup_lib", "type": "dir", "children": [{"name": "parseLawXml.ts.2025-09-13-040626", "type": "file"}]}, {"name": "features", "type": "dir", "children": [{"name": "accessible-law", "type": "dir", "children": [{"name": "HeaderPortal.tsx", "type": "file"}, {"name": "LawContent.tsx", "type": "file"}, {"name": "LawContent.tsx.bak.1758328917", "type": "file"}, {"name": "LawContent.tsx.bak.1758329094", "type": "file"}, {"name": "LawContext.tsx", "type": "file"}, {"name": "LawContext.tsx.bak.1758416557", "type": "file"}]}]}, {"name": "lib", "type": "dir", "children": [{"name": "html", "type": "dir", "children": [{"name": "splitAppendix.ts", "type": "file"}]}, {"name": "law", "type": "dir", "children": [{"name": "loadLaw.ts.bak.1758259132", "type": "file"}, {"name": "loadLaw.ts.bak.1758259251", "type": "file"}]}, {"name": "egov.ts", "type": "file"}, {"name": "egov.ts.bak.1758257453", "type": "file"}, {"name": "egov.ts.bak.1758257647", "type": "file"}, {"name": "egov.ts.bak.1758267919", "type": "file"}, {"name": "egov.ts.bak.1758270945", "type": "file"}, {"name": "egov.ts.bak.1758328392", "type": "file"}, {"name": "egov.ts.bak.1758415369", "type": "file"}, {"name": "fetchLaw.ts", "type": "file"}, {"name": "parseLawXml.backup.1757751382.ts", "type": "file"}, {"name": "parseLawXml.ts", "type": "file"}, {"name": "parseLawXml.ts.bak", "type": "file"}, {"name": "parseLawXml.ts.bak.1757735844", "type": "file"}, {"name": "parseLawXml.ts.bak.1757741756", "type": "file"}, {"name": "parseLawXml.ts.bak.1757741879", "type": "file"}, {"name": "parseLawXml.ts.bak.1757742057", "type": "file"}, {"name": "parseLawXml.ts.bak.1757742270", "type": "file"}, {"name": "parseLawXml.ts.bak.1757985875", "type": "file"}, {"name": "parseLawXml.ts.bak.1757986800", "type": "file"}, {"name": "parseLawXml.ts.bak.1757987151", "type": "file"}, {"name": "rokupo.ts", "type": "file"}, {"name": "rokupo.ts.bak.1758415557", "type": "file"}]}, {"name": "public", "type": "dir", "children": [{"name": "easy", "type": "dir", "children": [{"name": "ConstitutionofJapan.json", "type": "file"}, {"name": "TEST.json", "type": "file"}, {"name": "TEST_MULTI.json", "type": "file"}]}, {"name": "tree.html", "type": "file"}]}, {"name": "scripts", "type": "dir", "children": [{"name": "fs_tree.py", "type": "file"}, {"name": "fs_tree_html.py", "type": "file"}]}, {"name": "utils", "type": "dir", "children": [{"name": "htmlFilters.ts", "type": "file"}, {"name": "htmlFilters.ts.bak.1757987768", "type": "file"}, {"name": "htmlFilters.ts.bak.1757988347", "type": "file"}, {"name": "htmlFilters.ts.bak.1757988464", "type": "file"}, {"name": "htmlFilters.ts.bak.1757988929", "type": "file"}, {"name": "lawFormat.ts", "type": "file"}, {"name": "lawFormat.ts.bak.1757772696", "type": "file"}, {"name": "lawFormat.ts.bak.1757984292", "type": "file"}, {"name": "lawFormat.ts.bak.1757984420", "type": "file"}, {"name": "lawFormat.ts.bak.1757984621", "type": "file"}, {"name": "lawFormat.ts.bak.1757984844", "type": "file"}]}, {"name": "Article[]", "type": "file"}, {"name": "et --hard a8f09e9", "type": "file"}, {"name": "law.json", "type": "file"}, {"name": "next-env.d.ts", "type": "file"}, {"name": "package-lock.json", "type": "file"}, {"name": "package.json", "type": "file"}, {"name": "postcss.config.js", "type": "file"}, {"name": "t_'", "type": "file"}, {"name": "tailwind.config.js", "type": "file"}, {"name": "tailwind.config.js.bak", "type": "file"}, {"name": "tsconfig.json", "type": "file"}, {"name": "tsconfig.tsbuildinfo", "type": "file"}, {"name": "}", "type": "file"}]};
  const ROOT_LABEL = DATA.name || "repo";

  const $tree = document.getElementById('tree');
  const $q = document.getElementById('q');
  const $stats = document.getElementById('stats');
  const $rootName = document.getElementById('rootName');
  $rootName.textContent = "Root: " + ROOT_LABEL;

  const $pName = document.getElementById('p_name');
  const $pRole = document.getElementById('p_role');
  const $pDesc = document.getElementById('p_desc');
  const $pPath = document.getElementById('p_path');
  const $pType = document.getElementById('p_type');
  const $pExt  = document.getElementById('p_ext');

  function icon(node){
    if(node.type === 'dir') return "ğŸ“";
    const n = (node.name||"").toLowerCase();
    if(n.endsWith('.md')) return "ï¿½ï¿½";
    if(n.endsWith('.ts')||n.endsWith('.tsx')||n.endsWith('.js')||n.endsWith('.jsx')) return "ğŸ§©";
    if(n.endsWith('.json')) return "ğŸ§¾";
    if(n.endsWith('.png')||n.endsWith('.jpg')||n.endsWith('.jpeg')||n.endsWith('.svg')||n.endsWith('.gif')) return "ğŸ–¼ï¸";
    if(n.endsWith('.pdf')) return "ğŸ“„";
    return "ğŸ“„";
  }

  // ===== Next.js App Router å‘ã‘ å½¹å‰²åˆ¤å®š =====
  function roleInfo(path, isDir){
    const p = path.replace(/\\/g,'/'); // normalize
    const name = p.split('/').pop() || '';
    const ext = (name.includes('.') ? name.split('.').pop() : '').toLowerCase();

    // 1) ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª/ãƒ«ãƒ¼ãƒˆç³»
    if(isDir){
      if(p === 'app' || p.startsWith('app/')) return ['App Router ãƒ«ãƒ¼ãƒˆ', 'Next.js App Router ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»UIãƒ„ãƒªãƒ¼ã€‚å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¸‹ã« page/layout/error ãªã©ã‚’é…ç½®ã€‚'];
      if(p === 'public' || p.startsWith('public/')) return ['é™çš„ã‚¢ã‚»ãƒƒãƒˆ', 'ãã®ã¾ã¾é…ä¿¡ã•ã‚Œã‚‹å…¬é–‹ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãå ´ã€‚/favicon.ico ãªã©ã€‚'];
      if(p.startsWith('app/api/')) return ['API ãƒ«ãƒ¼ãƒˆç¾¤', 'App Router ã® Route Handlers ã‚’ã¾ã¨ã‚ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€‚HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æä¾›ã€‚'];
      if(p === 'components' || p.startsWith('components/')) return ['UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', 'å†åˆ©ç”¨å¯èƒ½ãªè¡¨ç¤ºéƒ¨å“ç½®ãå ´ã€‚'];
      if(p === 'lib' || p.startsWith('lib/')) return ['ãƒ©ã‚¤ãƒ–ãƒ©ãƒª/ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£', 'ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ç­‰ã€‚'];
      return ['ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª', ''];
    }

    // 2) app ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç‰¹åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«
    if(/^app\/.*\/page\.(tsx|jsx|js|ts)$/.test(p) || p === 'app/page.tsx' || p === 'app/page.jsx'){
      return ['ãƒšãƒ¼ã‚¸ï¼ˆRouteï¼‰', 'URL ã«ç›´æ¥å¯¾å¿œã™ã‚‹ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚'];
    }
    if(/^app\/.*\/layout\.(tsx|jsx|js|ts)$/.test(p) || p === 'app/layout.tsx' || p === 'app/layout.jsx'){
      return ['ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ', 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¸‹ã®å…±é€š UIã€‚children ã‚’å«ã‚€ã€‚'];
    }
    if(/^app\/.*\/template\.(tsx|jsx|js|ts)$/.test(p)){
      return ['ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ', 'ãƒã‚¦ãƒ³ãƒˆæ¯ã«å†ç”Ÿæˆã•ã‚Œã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç›¸å½“ã® UIã€‚'];
    }
    if(/^app\/.*\/loading\.(tsx|jsx|js|ts)$/.test(p)){
      return ['ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° UI', 'é…å»¶æ™‚ã«è¡¨ç¤ºã™ã‚‹ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚'];
    }
    if(/^app\/.*\/error\.(tsx|jsx|js|ts)$/.test(p)){
      return ['ã‚¨ãƒ©ãƒ¼ UI', 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…ä¸‹ã®ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã€‚'];
    }
    if(/^app\/.*\/not-found\.(tsx|jsx|js|ts)$/.test(p)){
      return ['404 UI', 'ãã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã® 404 è¡¨ç¤ºã€‚'];
    }
    if(/^app\/.*\/default\.(tsx|jsx|js|ts)$/.test(p)){
      return ['Parallel Routes æ—¢å®š', 'ãƒ‘ãƒ©ãƒ¬ãƒ«ãƒ«ãƒ¼ãƒˆã®æœªé¸æŠã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºã€‚'];
    }
    if(/^app\/.*\/route\.(ts|js)$/.test(p)){
      return ['Route Handler(API)', 'HTTP ãƒ¡ã‚½ãƒƒãƒ‰ã”ã¨ã®ãƒãƒ³ãƒ‰ãƒ©ã‚’å®šç¾©ã™ã‚‹ API ãƒ«ãƒ¼ãƒˆã€‚'];
    }
    if(/^middleware\.(ts|js)$/.test(name)){
      return ['Middleware', 'ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‰å‡¦ç†ï¼ˆå›½éš›åŒ–ãƒ»èªå¯ãªã©ï¼‰ã€‚'];
    }

    // 3) è¨­å®šãƒ»æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«
    if(name === 'next.config.js' || name === 'next.config.ts'){
      return ['Next.js è¨­å®š', 'Next.js å…¨ä½“ã®è¨­å®šã€‚'];
    }
    if(name === 'tailwind.config.js' || name === 'tailwind.config.ts'){
      return ['Tailwind è¨­å®š', 'Tailwind CSS ã®è¨­å®šã€‚'];
    }
    if(name === 'postcss.config.js' || name === 'postcss.config.cjs'){
      return ['PostCSS è¨­å®š', 'PostCSS ã®è¨­å®šã€‚'];
    }
    if(name === 'tsconfig.json'){
      return ['TypeScript è¨­å®š', 'TypeScript ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©è¨­å®šã€‚'];
    }
    if(name === 'package.json'){
      return ['ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å®šç¾©', 'ä¾å­˜é–¢ä¿‚ãƒ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ»ãƒ¡ã‚¿æƒ…å ±ã€‚'];
    }
    if(name === 'globals.css'){
      return ['ã‚°ãƒ­ãƒ¼ãƒãƒ« CSS', 'ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«ã€‚'];
    }
    if(/^robots\.txt$/.test(name)){
      return ['robots.txt', 'ã‚¯ãƒ­ãƒ¼ãƒ©å‘ã‘ã®ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ã€‚'];
    }
    if(/^sitemap\.xml$/.test(name)){
      return ['ã‚µã‚¤ãƒˆãƒãƒƒãƒ—', 'æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³å‘ã‘ URL ä¸€è¦§ã€‚'];
    }
    if(/^icon\.(png|ico|svg)$/.test(name) || name === 'favicon.ico'){
      return ['ã‚µã‚¤ãƒˆã‚¢ã‚¤ã‚³ãƒ³', 'ãƒ–ãƒ©ã‚¦ã‚¶ã‚„ PWA ç”¨ã®ã‚¢ã‚¤ã‚³ãƒ³ã€‚'];
    }

    // 4) ã‚ˆãã‚ã‚‹é…ç½®
    if(p.startsWith('components/') && /\.(tsx|jsx|ts|js)$/.test(name)){
      return ['UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ', 'å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚'];
    }
    if(p.startsWith('lib/') && /\.(ts|js)$/.test(name)){
      return ['ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£/ãƒ­ã‚¸ãƒƒã‚¯', 'é–¢æ•°ç¾¤ã‚„ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®å®Ÿè£…ã€‚'];
    }
    if(p.startsWith('public/')){
      return ['é™çš„ã‚¢ã‚»ãƒƒãƒˆ', 'ãã®ã¾ã¾é…ä¿¡ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€‚'];
    }

    // 5) æ‹¡å¼µå­ãƒ™ãƒ¼ã‚¹ã®æ±ç”¨
    if(['ts','tsx','js','jsx'].includes(ext)) return ['ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰', ''];
    if(['css','scss'].includes(ext)) return ['ã‚¹ã‚¿ã‚¤ãƒ«', ''];
    if(['md','mdx'].includes(ext)) return ['ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ', ''];
    if(['json'].includes(ext)) return ['è¨­å®š/ãƒ‡ãƒ¼ã‚¿(JSON)', ''];
    return ['ãƒ•ã‚¡ã‚¤ãƒ«', ''];
  }

  function build(node, basePath){
    // basePath: è¦ªã¾ã§ã®ç›¸å¯¾ãƒ‘ã‚¹
    if(node.type === 'dir'){
      const det = document.createElement('details');
      const sum = document.createElement('summary');
      const path = basePath ? (basePath + '/' + node.name) : node.name;
      sum.innerHTML = '<span class="node dir clickable"><span>'+icon(node)+'</span><span class="label">'+escapeHtml(node.name)+'/</span><span class="muted">'+(node.children?.length||0)+'é …ç›®</span></span>';
      sum.dataset.path = path;
      sum.onclick = (e)=>{ e.stopPropagation(); select(path, true); };
      det.appendChild(sum);
      const ul = document.createElement('ul');
      (node.children||[]).sort((a,b)=>{
        const da = (a.type==='dir')?0:1, db = (b.type==='dir')?0:1;
        if(da!==db) return da-db;
        return a.name.localeCompare(b.name, 'ja');
      }).forEach(ch=>{
        ul.appendChild(buildItem(ch, path));
      });
      det.appendChild(ul);
      return det;
    } else {
      return buildItem(node, basePath);
    }
  }

  function buildItem(node, basePath){
    const path = basePath ? (basePath + '/' + node.name) : node.name;
    if(node.type === 'dir'){
      const li = document.createElement('li');
      const det = build(node, path);
      li.appendChild(det);
      return li;
    }
    const li = document.createElement('li');
    li.className = 'file';
    const span = document.createElement('span');
    span.className = 'node clickable';
    span.dataset.path = path;
    span.onclick = (e)=>{ e.stopPropagation(); select(path, false, li); };
    span.innerHTML = '<span>'+icon(node)+'</span><span class="label">'+escapeHtml(node.name)+'</span>'+extBadge(node.name);
    li.appendChild(span);
    return li;
  }

  function extBadge(name){
    const idx = name.lastIndexOf('.');
    if(idx<=0) return '';
    const ext = name.slice(idx+1);
    return ' <span class="ext">.'+escapeHtml(ext)+'</span>';
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
  }

  function render(){
    $tree.innerHTML = '';
    $tree.appendChild(build(DATA, ''));
    $stats.textContent = countStats(DATA);
  }

  function countStats(node){
    let files=0, dirs=0;
    function walk(n){
      if(n.type==='dir'){
        dirs++;
        (n.children||[]).forEach(walk);
      } else files++;
    }
    walk(node);
    return `dirs: ${dirs-1}, files: ${files}`;
  }

  function match(glob, text){
    if(!glob) return true;
    glob = glob.toLowerCase();
    text = text.toLowerCase();
    const parts = glob.split('*');
    let pos = 0;
    for(const p of parts){
      if(!p) continue;
      const i = text.indexOf(p, pos);
      if(i<0) return false;
      pos = i + p.length;
    }
    return true;
  }

  function filterTree(q){
    const glob = q.trim();
    let hits = 0;

    function recurse(el){
      if(el.tagName==='DETAILS'){
        const sum = el.querySelector(':scope > summary .label');
        const name = sum?.textContent || '';
        const ul = el.querySelector(':scope > ul');
        let childHit = 0;
        ul.querySelectorAll(':scope > li').forEach(li=>{
          const h = recurse(li);
          childHit += h;
          li.style.display = h ? '' : 'none';
        });
        const selfHit = match(glob, name);
        const hit = selfHit || childHit>0;
        sum?.classList.toggle('hit', selfHit && glob);
        el.style.display = hit ? '' : 'none';
        el.open = hit && glob ? true : el.open;
        hits += hit ? 1 : 0;
        return hit ? 1 : 0;
      } else if(el.tagName==='LI'){
        const lab = el.querySelector(':scope .label');
        const name = lab?.textContent || '';
        const isHit = match(glob, name);
        lab?.classList.toggle('hit', isHit && glob);
        hits += isHit ? 1 : 0;
        return isHit ? 1 : 0;
      }
      return 0;
    }

    const top = $tree.firstElementChild;
    if(!top) return;
    recurse(top);
    $stats.textContent = countStats(DATA) + (glob ? ` | hits: ${hits}` : '');
  }

  // é¸æŠã—ã¦å³ãƒšã‚¤ãƒ³ã¸åæ˜ 
  let lastSel;
  function select(path, isDir, liElem){
    if(lastSel) lastSel.classList.remove('selected');
    if(liElem) { liElem.classList.add('selected'); lastSel = liElem; }
    const name = path.split('/').pop() || path;
    const ext = (name.includes('.') ? name.split('.').pop() : '');
    const [role, desc] = roleInfo(path, isDir);
    $pName.textContent = name;
    $pRole.textContent = role || '';
    $pDesc.textContent = desc || '';
    $pPath.textContent = path;
    $pType.textContent = isDir ? 'directory' : 'file';
    $pExt.textContent = isDir ? '-' : (ext || '(none)');
  }

  // åˆæœŸæç”»
  render();

  // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
  document.getElementById('expand').onclick = ()=> {
    $tree.querySelectorAll('details').forEach(d=>d.open = true);
  };
  document.getElementById('collapse').onclick = ()=> {
    $tree.querySelectorAll('details').forEach(d=>d.open = false);
  };
  let t=null;
  $q.addEventListener('input', ()=>{
    clearTimeout(t); t=setTimeout(()=>filterTree($q.value), 120);
  });
</script>
</body>
</html>
